
public class MainActivity extends AppCompatActivity {
    EditText usr,pwd;
    CheckBox rem;
    private ProgressBar progressBar;
    Button btn;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        usr=(EditText) findViewById(R.id.txtUserName);
        pwd=(EditText)findViewById(R.id.txtpassword);
        rem=(CheckBox) findViewById(R.id.checkBox);
        btn = (Button) findViewById(R.id.btnlogin);
        progressBar=(ProgressBar)findViewById(R.id.progressBar);
        SharedPreferences sharedpreferences = getSharedPreferences("MyPREFERENCES", Context.MODE_PRIVATE);
        String name=sharedpreferences.getString("username","");
        String pass=sharedpreferences.getString("password","");
        usr.setText(name);
        pwd.setText(pass);
        rem.setChecked(true);
    }
    public void loginFun(View v){

        String name=usr.getText().toString();
        String pass=pwd.getText().toString();
        new MyTask().execute(name, pass, "pleiades.kletech.ac.in/app/login.php");


//        if(name.equals(pass)){
//            Toast.makeText(getApplicationContext(),"Valid User",Toast.LENGTH_LONG).show();
//            if(rem.isChecked()){
//                SharedPreferences sharedpreferences = getSharedPreferences("MyPREFERENCES", Context.MODE_PRIVATE);
//                SharedPreferences.Editor editor = sharedpreferences.edit();
//                editor.putString("username", name);
//                editor.putString("password", pass);
//                editor.commit();
//            }
//            Intent intent = new Intent(this, HomeActivity.class);
//            intent.putExtra("EXTRA_MESSAGE", name);
//            startActivity(intent);
//            finish();
//        }
//        else{
//            Toast.makeText(getApplicationContext(),"Invalid User",Toast.LENGTH_LONG).show();
//        }
    }
    public void resetFun(View v) {
        EditText usr = (EditText) findViewById(R.id.txtUserName);
        usr.setText("");
        EditText pwd = (EditText) findViewById(R.id.txtpassword);
        pwd.setText("");
    }

    class MyTask extends AsyncTask<String, Void, JSONObject> {
        @Override
        protected void onPreExecute() {
            progressBar.setVisibility(View.VISIBLE);
            btn.setVisibility(View.INVISIBLE);
        }
        @Override
        protected JSONObject doInBackground(String... params) {
            InputStream is = null;
            String error = "";
            String json = "";
            JSONObject jObj = null;

            String val =params[0];
            String val2 =params[1];
            String yoururl =params[2];
            try {

                String url = "http://"+yoururl;
                ArrayList<NameValuePair> valuePairs=new ArrayList<NameValuePair>();
                valuePairs.add(new BasicNameValuePair("username",val));
                valuePairs.add(new BasicNameValuePair("password",val2));
                // request method is GET
                DefaultHttpClient httpClient = new DefaultHttpClient();
                String paramString = URLEncodedUtils.format(valuePairs, "utf-8");
                url += "?" + paramString;
                HttpGet httpGet = new HttpGet(url);

                HttpResponse httpResponse = httpClient.execute(httpGet);
                HttpEntity httpEntity = httpResponse.getEntity();
                is = httpEntity.getContent();

                BufferedReader reader = new BufferedReader(new InputStreamReader(
                        is, "iso-8859-1"), 100);
                StringBuilder sb = new StringBuilder();
                String line = null;
                while ((line = reader.readLine()) != null) {
                    sb.append(line + "\n");
                }
                is.close();
                json = sb.toString();
                jObj = new JSONObject(json);
                jObj.put("error_code",error);

            }catch (Exception e){}
            return jObj;
        }

        @Override
        protected void onPostExecute(JSONObject result) {
            progressBar.setVisibility(View.INVISIBLE);
            btn.setVisibility(View.VISIBLE);
            try {
                if (result != null) {
                    if (!result.isNull("message")) {
                        String message = result.getString("message");
                        if (message.equals("success")) {
                            Toast.makeText(getApplicationContext(),"Valid User",Toast.LENGTH_SHORT).show();
                            Intent intent = new Intent(getApplicationContext(), Main2Activity.class);
                            //            intent.putExtra("EXTRA_MESSAGE", name);
                            startActivity(intent);
                            finish();
                        }else{
                            Toast.makeText(getApplicationContext(),"Invalid username or password",Toast.LENGTH_SHORT).show();
                        }
                    }
                } else {
                    Toast.makeText(getApplicationContext(),"Failed to send data",Toast.LENGTH_SHORT).show();
                }

            } catch (JSONException e) {
                Toast.makeText(getApplicationContext(),"Failed to send data",Toast.LENGTH_SHORT).show();
            }
        }
    }
}
